"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const mongoose_1 = __importDefault(require("mongoose"));
const Sensor_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Sensor"));
const Valore_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Valore"));
class SensoresController {
    async guardarMongo({ request, response }) {
        const trigger = request.input('trigger');
        const echo = request.input('echo');
        try {
            await mongoose_1.default.connect('mongodb://18.220.12.4:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = new Sensor_1.default.SensorModelo({
                "id": request.input('id'),
                "pin": [{
                        "trigger": trigger,
                        "echo": echo
                    }],
                "tipo": request.input('tipo'),
                "clave": request.input('clave'),
            });
            response.save();
            return response;
        }
        catch {
            await mongoose_1.default.connect('mongodb://3.145.210.35:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = new Sensor_1.default.SensorModelo({
                "id": request.input('id'),
                "pin": [
                    trigger,
                    echo
                ],
                "tipo": request.input('tipo'),
                "clave": request.input('clave'),
            });
            response.save();
            return response;
        }
    }
    async verSensor({ params, response }) {
        try {
            await mongoose_1.default.connect('mongodb://18.220.12.4:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = await Sensor_1.default.SensorModelo.find({ "id": params.id });
            return response;
        }
        catch {
            await mongoose_1.default.connect('mongodb://3.145.210.35:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = await Sensor_1.default.SensorModelo.find({ "id": params.id });
            return response;
        }
    }
    async verSensores({ response }) {
        try {
            await mongoose_1.default.connect('mongodb://18.220.12.4:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = await Sensor_1.default.SensorModelo.find();
            return response;
        }
        catch {
            await mongoose_1.default.connect('mongodb://3.145.210.35:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = await Sensor_1.default.SensorModelo.find();
            return response;
        }
    }
    async modificar({ request, response }) {
        try {
            await mongoose_1.default.connect('mongodb://18.220.12.4:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            const id = request.input('id');
            response = await Sensor_1.default.SensorModelo.updateOne({ "id": id }, { $set: { "pin": { "trigger": request.input('trigger'), "echo": request.input('echo') }, "tipo": request.input('tipo'), "clave": request.input('clave') } });
            return response;
        }
        catch {
        }
    }
    async guardarMedicion({ request, response }) {
        const id = request.input('id');
        const clave = request.input('clave');
        const fecha = request.input('fecha');
        const hora = request.input('hora');
        const valor = request.input('valor');
        try {
            await mongoose_1.default.connect('mongodb://18.220.12.4:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = new Valore_1.default.Valore({
                "id": id,
                "fecha": fecha,
                "clave": clave,
                "hora": hora,
                "valor": valor
            });
            response.save();
            return response;
        }
        catch {
            await mongoose_1.default.connect('mongodb://3.145.210.35:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = new Valore_1.default.Valore({
                "id": id,
                "fecha": fecha,
                "clave": clave,
                "hora": hora,
                "valor": valor
            });
            response.save();
            return response;
        }
    }
}
exports.default = SensoresController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2Vuc29yZXNDb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU2Vuc29yZXNDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0Esd0RBQStCO0FBQy9CLHFGQUE0QztBQUM1QyxxRkFBc0M7QUFDdEMsTUFBcUIsa0JBQWtCO0lBRXhCLEtBQUssQ0FBQyxZQUFZLENBQUMsRUFBQyxPQUFPLEVBQUMsUUFBUSxFQUFDO1FBRTVDLE1BQU0sT0FBTyxHQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUE7UUFDdEMsTUFBTSxJQUFJLEdBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUNoQyxJQUNBO1lBQ0ksTUFBTSxrQkFBUSxDQUFDLE9BQU8sQ0FBQyw2RkFBNkYsQ0FBQyxDQUFBO1lBQ3BILFFBQVEsR0FBQyxJQUFJLGdCQUFZLENBQUMsWUFBWSxDQUFDO2dCQUNwQyxJQUFJLEVBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7Z0JBQ3pCLEtBQUssRUFBRSxDQUFDO3dCQUNMLFNBQVMsRUFBQyxPQUFPO3dCQUNqQixNQUFNLEVBQUMsSUFBSTtxQkFDYixDQUFDO2dCQUNGLE1BQU0sRUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztnQkFDN0IsT0FBTyxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDO2FBQ2xDLENBQUMsQ0FBQTtZQUNGLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtZQUNmLE9BQU8sUUFBUSxDQUFBO1NBQ2xCO1FBQ0QsTUFDQTtZQUNJLE1BQU0sa0JBQVEsQ0FBQyxPQUFPLENBQUMsOEZBQThGLENBQUMsQ0FBQTtZQUNySCxRQUFRLEdBQUMsSUFBSSxnQkFBWSxDQUFDLFlBQVksQ0FBQztnQkFDcEMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO2dCQUN6QixLQUFLLEVBQUU7b0JB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QUFLLENBQUMsT0FBTyxDQUFDLENBQUE7UUFDbEMsSUFDQTtZQUNJLE1BQU0sa0JBQVEsQ0FBQyxPQUFPLENBQUMsNkZBQTZGLENBQUMsQ0FBQTtZQUNwSCxRQUFRLEdBQUMsSUFBSSxnQkFBTSxDQUFDLE1BQU0sQ0FBQztnQkFDeEIsSUFBSSxFQUFFLEVBQUU7Z0JBQ1IsT0FBTyxFQUFDLEtBQUs7Z0JBQ2IsT0FBTyxFQUFFLEtBQUs7Z0JBQ2QsTUFBTSxFQUFDLElBQUk7Z0JBQ1gsT0FBTyxFQUFDLEtBQUs7YUFDaEIsQ0FBQyxDQUFBO1lBQ0YsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFBO1lBQ2YsT0FBTyxRQUFRLENBQUE7U0FDbEI7UUFDRCxNQUNBO1lBQ0ksTUFBTSxrQkFBUSxDQUFDLE9BQU8sQ0FBQyw4RkFBOEYsQ0FBQyxDQUFBO1lBQ3JILFFBQVEsR0FBQyxJQUFJLGdCQUFNLENBQUMsTUFBTSxDQUFDO2dCQUN4QixJQUFJLEVBQUUsRUFBRTtnQkFDUixPQUFPLEVBQUMsS0FBSztnQkFDYixPQUFPLEVBQUUsS0FBSztnQkFDZCxNQUFNLEVBQUMsSUFBSTtnQkFDWCxPQUFPLEVBQUMsS0FBSzthQUNoQixDQUFDLENBQUE7WUFDRixRQUFRLENBQUMsSUFBSSxFQUFFLENBQUE7WUFDZixPQUFPLFFBQVEsQ0FBQTtTQUN0QjtJQUNMLENBQUM7Q0FDQTtBQXZIRCxxQ0F1SEMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbXBvcnQgdHlwZSB7IEh0dHBDb250ZXh0Q29udHJhY3QgfSBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0h0dHBDb250ZXh0J1xuaW1wb3J0IG1vbmdvb3NlIGZyb20gXCJtb25nb29zZVwiXG5pbXBvcnQgU2Vuc29yTW9kZWxvIGZyb20gXCJBcHAvTW9kZWxzL1NlbnNvclwiXG5pbXBvcnQgVmFsb3JlIGZyb20gXCJBcHAvTW9kZWxzL1ZhbG9yZVwiXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZW5zb3Jlc0NvbnRyb2xsZXIgXG57XG4gICAgICAgIHB1YmxpYyBhc3luYyBndWFyZGFyTW9uZ28oe3JlcXVlc3QscmVzcG9uc2V9KVxuICAgIHsgIFxuICAgICAgICBjb25zdCB0cmlnZ2VyPXJlcXVlc3QuaW5wdXQoJ3RyaWdnZXInKVxuICAgICAgICBjb25zdCBlY2hvPXJlcXVlc3QuaW5wdXQoJ2VjaG8nKSAgXG4gICAgICAgIHRyeVxuICAgICAgICB7XG4gICAgICAgICAgICBhd2FpdCBtb25nb29zZS5jb25uZWN0KCdtb25nb2RiOi8vMTguMjIwLjEyLjQ6MjcwMTcvU2Vuc29yZXM/cmVhZFByZWZlcmVuY2U9cHJpbWFyeSZkaXJlY3RDb25uZWN0aW9uPXRydWUmc3NsPWZhbHNlJykgXG4gICAgICAgICAgICAgcmVzcG9uc2U9bmV3IFNlbnNvck1vZGVsby5TZW5zb3JNb2RlbG8oe1xuICAgICAgICAgICAgICAgIFwiaWRcIjogcmVxdWVzdC5pbnB1dCgnaWQnKSxcbiAgICAgICAgICAgICAgICBcInBpblwiOiBbe1xuICAgICAgICAgICAgICAgICAgIFwidHJpZ2dlclwiOnRyaWdnZXIsXG4gICAgICAgICAgICAgICAgICAgXCJlY2hvXCI6ZWNob1xuICAgICAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgICAgIFwidGlwb1wiOiByZXF1ZXN0LmlucHV0KCd0aXBvJyksXG4gICAgICAgICAgICAgICAgXCJjbGF2ZVwiOiByZXF1ZXN0LmlucHV0KCdjbGF2ZScpLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHJlc3BvbnNlLnNhdmUoKVxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2hcbiAgICAgICAge1xuICAgICAgICAgICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdCgnbW9uZ29kYjovLzMuMTQ1LjIxMC4zNToyNzAxNy9TZW5zb3Jlcz9yZWFkUHJlZmVyZW5jZT1wcmltYXJ5JmRpcmVjdENvbm5lY3Rpb249dHJ1ZSZzc2w9ZmFsc2UnKSBcbiAgICAgICAgICAgICByZXNwb25zZT1uZXcgU2Vuc29yTW9kZWxvLlNlbnNvck1vZGVsbyh7XG4gICAgICAgICAgICAgICAgXCJpZFwiOiByZXF1ZXN0LmlucHV0KCdpZCcpLFxuICAgICAgICAgICAgICAgIFwicGluXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcixcbiAgICAgICAgICAgICAgICAgICAgZWNob1xuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXCJ0aXBvXCI6IHJlcXVlc3QuaW5wdXQoJ3RpcG8nKSxcbiAgICAgICAgICAgICAgICBcImNsYXZlXCI6IHJlcXVlc3QuaW5wdXQoJ2NsYXZlJyksXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgcmVzcG9uc2Uuc2F2ZSgpXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfVxuICAgIH1cbiAgICBwdWJsaWMgYXN5bmMgdmVyU2Vuc29yKHtwYXJhbXMscmVzcG9uc2V9KVxuICAgIHtcbiAgICAgICAgdHJ5XG4gICAgICAgIHtcbiAgICAgICAgICAgIGF3YWl0IG1vbmdvb3NlLmNvbm5lY3QoJ21vbmdvZGI6Ly8xOC4yMjAuMTIuNDoyNzAxNy9TZW5zb3Jlcz9yZWFkUHJlZmVyZW5jZT1wcmltYXJ5JmRpcmVjdENvbm5lY3Rpb249dHJ1ZSZzc2w9ZmFsc2UnKVxuICAgICAgICAgICAgcmVzcG9uc2U9YXdhaXQgU2Vuc29yTW9kZWxvLlNlbnNvck1vZGVsby5maW5kKHtcImlkXCI6cGFyYW1zLmlkfSlcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoXG4gICAgICAgIHtcbiAgICAgICAgICAgIGF3YWl0IG1vbmdvb3NlLmNvbm5lY3QoJ21vbmdvZGI6Ly8zLjE0NS4yMTAuMzU6MjcwMTcvU2Vuc29yZXM/cmVhZFByZWZlcmVuY2U9cHJpbWFyeSZkaXJlY3RDb25uZWN0aW9uPXRydWUmc3NsPWZhbHNlJylcbiAgICAgICAgICAgIHJlc3BvbnNlPWF3YWl0IFNlbnNvck1vZGVsby5TZW5zb3JNb2RlbG8uZmluZCh7XCJpZFwiOnBhcmFtcy5pZH0pXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfVxuICAgIH1cbiAgICBwdWJsaWMgYXN5bmMgdmVyU2Vuc29yZXMoe3Jlc3BvbnNlfSlcbiAgICB7XG4gICAgICAgIHRyeVxuICAgICAgICB7XG4gICAgICAgICAgICBhd2FpdCBtb25nb29zZS5jb25uZWN0KCdtb25nb2RiOi8vMTguMjIwLjEyLjQ6MjcwMTcvU2Vuc29yZXM/cmVhZFByZWZlcmVuY2U9cHJpbWFyeSZkaXJlY3RDb25uZWN0aW9uPXRydWUmc3NsPWZhbHNlJylcbiAgICAgICAgICAgIHJlc3BvbnNlPWF3YWl0IFNlbnNvck1vZGVsby5TZW5zb3JNb2RlbG8uZmluZCgpXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfVxuICAgICAgICBjYXRjaFxuICAgICAgICB7XG4gICAgICAgICAgICBhd2FpdCBtb25nb29zZS5jb25uZWN0KCdtb25nb2RiOi8vMy4xNDUuMjEwLjM1OjI3MDE3L1NlbnNvcmVzP3JlYWRQcmVmZXJlbmNlPXByaW1hcnkmZGlyZWN0Q29ubmVjdGlvbj10cnVlJnNzbD1mYWxzZScpXG4gICAgICAgICAgICByZXNwb25zZT1hd2FpdCBTZW5zb3JNb2RlbG8uU2Vuc29yTW9kZWxvLmZpbmQoKVxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH1cbiAgICB9XG4gICAgcHVibGljIGFzeW5jIG1vZGlmaWNhcih7cmVxdWVzdCxyZXNwb25zZX0pXG4gICAge1xuICAgICAgICB0cnlcbiAgICAgICAge1xuICAgICAgICAgICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdCgnbW9uZ29kYjovLzE4LjIyMC4xMi40OjI3MDE3L1NlbnNvcmVzP3JlYWRQcmVmZXJlbmNlPXByaW1hcnkmZGlyZWN0Q29ubmVjdGlvbj10cnVlJnNzbD1mYWxzZScpXG4gICAgICAgICAgICBjb25zdCBpZD1yZXF1ZXN0LmlucHV0KCdpZCcpXG4gICAgICAgICAgICByZXNwb25zZT0gYXdhaXQgU2Vuc29yTW9kZWxvLlNlbnNvck1vZGVsby51cGRhdGVPbmUoe1wiaWRcIjppZH0seyRzZXQ6e1wicGluXCI6e1widHJpZ2dlclwiOnJlcXVlc3QuaW5wdXQoJ3RyaWdnZXInKSxcImVjaG9cIjpyZXF1ZXN0LmlucHV0KCdlY2hvJyl9LFwidGlwb1wiOnJlcXVlc3QuaW5wdXQoJ3RpcG8nKSxcImNsYXZlXCI6cmVxdWVzdC5pbnB1dCgnY2xhdmUnKX19KVxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2hcbiAgICAgICAge1xuLy8gICAgICAgICAgICBhd2FpdCBtb25nb29zZS5jb25uZWN0KCdtb25nb2RiOi8vMy4xNDUuMjEwLjM1OjI3MDE3L1NlbnNvcmVzP3JlYWRQcmVmZXJlbmNlPXByaW1hcnkmZGlyZWN0Q29ubmVjdGlvbj10cnVlJnNzbD1mYWxzZScpXG4vLyAgICAgICAgICAgIGNvbnN0IGlkPXJlcXVlc3QuaW5wdXQoJ2lkJylcbi8vICAgICAgICAgICAgbW9kPSBhd2FpdCBTZW5zb3JNb2RlbG8uU2Vuc29yTW9kZWxvLnVwZGF0ZU9uZSh7XCJpZFwiOmlkfSx7JHB1bGw6e1wicGluXCI6eyRndGU6MX19fSlcbi8vICAgICAgICAgICAgcmVzcG9uc2U9IGF3YWl0IFNlbnNvck1vZGVsby5TZW5zb3JNb2RlbG8udXBkYXRlT25lKHtcImlkXCI6aWR9LHskcHVzaDp7XCJwaW5cIjpbcmVxdWVzdC5pbnB1dCgndHJpZ2dlcicpLHJlcXVlc3QuaW5wdXQoJ2VjaG8nKV19fSlcbi8vICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH1cbiAgICB9XG4gICAgICAgIHB1YmxpYyBhc3luYyBndWFyZGFyTWVkaWNpb24oe3JlcXVlc3QscmVzcG9uc2V9KVxuICAgIHtcbiAgICAgICAgY29uc3QgaWQ9cmVxdWVzdC5pbnB1dCgnaWQnKVxuICAgICAgICBjb25zdCBjbGF2ZT1yZXF1ZXN0LmlucHV0KCdjbGF2ZScpXG4gICAgICAgIGNvbnN0IGZlY2hhPXJlcXVlc3QuaW5wdXQoJ2ZlY2hhJylcbiAgICAgICAgY29uc3QgaG9yYT1yZXF1ZXN0LmlucHV0KCdob3JhJylcbiAgICAgICAgY29uc3QgdmFsb3I9cmVxdWVzdC5pbnB1dCgndmFsb3InKVxuICAgICAgICB0cnlcbiAgICAgICAge1xuICAgICAgICAgICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdCgnbW9uZ29kYjovLzE4LjIyMC4xMi40OjI3MDE3L1NlbnNvcmVzP3JlYWRQcmVmZXJlbmNlPXByaW1hcnkmZGlyZWN0Q29ubmVjdGlvbj10cnVlJnNzbD1mYWxzZScpIFxuICAgICAgICAgICAgIHJlc3BvbnNlPW5ldyBWYWxvcmUuVmFsb3JlKHtcbiAgICAgICAgICAgICAgICBcImlkXCI6IGlkLFxuICAgICAgICAgICAgICAgIFwiZmVjaGFcIjpmZWNoYSxcbiAgICAgICAgICAgICAgICBcImNsYXZlXCI6IGNsYXZlLFxuICAgICAgICAgICAgICAgIFwiaG9yYVwiOmhvcmEsXG4gICAgICAgICAgICAgICAgXCJ2YWxvclwiOnZhbG9yXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgcmVzcG9uc2Uuc2F2ZSgpXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfVxuICAgICAgICBjYXRjaFxuICAgICAgICB7XG4gICAgICAgICAgICBhd2FpdCBtb25nb29zZS5jb25uZWN0KCdtb25nb2RiOi8vMy4xNDUuMjEwLjM1OjI3MDE3L1NlbnNvcmVzP3JlYWRQcmVmZXJlbmNlPXByaW1hcnkmZGlyZWN0Q29ubmVjdGlvbj10cnVlJnNzbD1mYWxzZScpIFxuICAgICAgICAgICAgIHJlc3BvbnNlPW5ldyBWYWxvcmUuVmFsb3JlKHtcbiAgICAgICAgICAgICAgICBcImlkXCI6IGlkLFxuICAgICAgICAgICAgICAgIFwiZmVjaGFcIjpmZWNoYSxcbiAgICAgICAgICAgICAgICBcImNsYXZlXCI6IGNsYXZlLFxuICAgICAgICAgICAgICAgIFwiaG9yYVwiOmhvcmEsXG4gICAgICAgICAgICAgICAgXCJ2YWxvclwiOnZhbG9yXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgcmVzcG9uc2Uuc2F2ZSgpXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICB9XG59XG59IFxuIl19