"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const mongoose_1 = __importDefault(require("mongoose"));
const Sensor_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Sensor"));
const Valore_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Valore"));
class SensoresController {
    async guardarMongo({ request, response }) {
        const trigger = request.input('trigger');
        const echo = request.input('echo');
        try {
            await mongoose_1.default.connect('mongodb://18.220.12.4:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = new Sensor_1.default.SensorModelo({
                "id": request.input('id'),
                "pin": [{
                        "trigger": trigger,
                        "echo": echo
                    }],
                "tipo": request.input('tipo'),
                "clave": request.input('clave'),
            });
            response.save();
            return response;
        }
        catch {
            await mongoose_1.default.connect('mongodb://3.145.210.35:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = new Sensor_1.default.SensorModelo({
                "id": request.input('id'),
                "pin": [
                    trigger,
                    echo
                ],
                "tipo": request.input('tipo'),
                "clave": request.input('clave'),
            });
            response.save();
            return response;
        }
    }
    async verSensor({ params, response }) {
        try {
            await mongoose_1.default.connect('mongodb://18.220.12.4:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = await Sensor_1.default.SensorModelo.find({ "id": params.id });
            return response;
        }
        catch {
            await mongoose_1.default.connect('mongodb://3.145.210.35:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = await Sensor_1.default.SensorModelo.find({ "id": params.id });
            return response;
        }
    }
    async verSensores({ response }) {
        try {
            await mongoose_1.default.connect('mongodb://18.220.12.4:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = await Sensor_1.default.SensorModelo.find();
            return response;
        }
        catch {
            await mongoose_1.default.connect('mongodb://3.145.210.35:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = await Sensor_1.default.SensorModelo.find();
            return response;
        }
    }
    async modificar({ request, response }) {
        try {
            await mongoose_1.default.connect('mongodb://18.220.12.4:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            const id = request.input('id');
            response = await Sensor_1.default.SensorModelo.updateOne({ "id": id }, { $set: { "pin": { "trigger": request.input('trigger'), "echo": request.input('echo') }, "tipo": request.input('tipo'), "clave": request.input('clave') } });
            return response;
        }
        catch {
        }
    }
    async guardarMedicion({ request, response }) {
        const id = request.input('id');
        const clave = request.input('clave');
        const fecha = request.input('fecha');
        const hora = request.input('hora');
        const valor = request.input('valor');
        try {
            await mongoose_1.default.connect('mongodb://18.220.12.4:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = new Valore_1.default.Valore({
                "id": id,
                "fecha": fecha,
                "clave": clave,
                "hora": hora,
                "valor": valor
            });
            response.save();
            return response;
        }
        catch {
            await mongoose_1.default.connect('mongodb://3.145.210.35:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = new Valore_1.default.Valore({
                "id": id,
                "fecha": fecha,
                "clave": clave,
                "hora": hora,
                "valor": valor
            });
            response.save();
            return response;
        }
    }
    async US({ params, response }) {
        try {
            await mongoose_1.default.connect('mongodb://18.220.12.4:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = await Valore_1.default.Valore.aggregate([
                {
                    '$match': {
                        'id': Number(params.id)
                    }
                }, {
                    $lookup: {
                        'from': 'sensors',
                        'localField': 'id',
                        'foreignField': 'id',
                        'as': 'Sensores'
                    }
                }, {
                    '$unwind': {
                        'path': '$Sensores',
                        'preserveNullAndEmptyArrays': true
                    }
                }, {
                    '$project': {
                        'id': 1,
                        'clave': 1,
                        'valor': 1,
                        'created_at': {
                            '$concat': [
                                '$fecha', ' ', '$hora'
                            ]
                        }
                    }
                }
            ]);
            return response;
        }
        catch {
            await mongoose_1.default.connect('mongodb://3.145.210.35:27017/Sensores?readPreference=primary&directConnection=true&ssl=false');
            response = await Valore_1.default.Valore.aggregate();
            return response;
        }
    }
}
exports.default = SensoresController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2Vuc29yZXNDb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU2Vuc29yZXNDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0Esd0RBQStCO0FBQy9CLHFGQUE0QztBQUM1QyxxRkFBc0M7QUFDdEMsTUFBcUIsa0JBQWtCO0lBRXhCLEtBQUssQ0FBQyxZQUFZLENBQUMsRUFBQyxPQUFPLEVBQUMsUUFBUSxFQUFDO1FBRTVDLE1BQU0sT0FBTyxHQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUE7UUFDdEMsTUFBTSxJQUFJLEdBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUNoQyxJQUNBO1lBQ0ksTUFBTSxrQkFBUSxDQUFDLE9BQU8sQ0FBQyw2RkFBNkYsQ0FBQyxDQUFBO1lBQ3BILFFBQVEsR0FBQyxJQUFJLGdCQUFZLENBQUMsWUFBWSxDQUFDO2dCQUNwQyxJQUFJLEVBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7Z0JBQ3pCLEtBQUssRUFBRSxDQUFDO3dCQUNMLFNBQVMsRUFBQyxPQUFPO3dCQUNqQixNQUFNLEVBQUMsSUFBSTtxQkFDYixDQUFDO2dCQUNGLE1BQU0sRUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztnQkFDN0IsT0FBTyxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDO2FBQ2xDLENBQUMsQ0FBQTtZQUNGLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtZQUNmLE9BQU8sUUFBUSxDQUFBO1NBQ2xCO1FBQ0QsTUFDQTtZQUNJLE1BQU0sa0JBQVEsQ0FBQyxPQUFPLENBQUMsOEZBQThGLENBQUMsQ0FBQTtZQUNySCxRQUFRLEdBQUMsSUFBSSxnQkFBWSxDQUFDLFlBQVksQ0FBQztnQkFDcEMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO2dCQUN6QixLQUFLLEVBQUU7b0JB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QUNsQixjQUFjLEVBQUUsSUFBSTt3QkFDcEIsSUFBSSxFQUFFLFVBQVU7cUJBQ2pCO2lCQUNGLEVBQUU7b0JBQ0QsU0FBUyxFQUFFO3dCQUNULE1BQU0sRUFBRSxXQUFXO3dCQUNuQiw0QkFBNEIsRUFBRSxJQUFJO3FCQUNuQztpQkFDRixFQUFFO29CQUNELFVBQVUsRUFBRTt3QkFDVixJQUFJLEVBQUUsQ0FBQzt3QkFDUCxPQUFPLEVBQUUsQ0FBQzt3QkFDVixPQUFPLEVBQUUsQ0FBQzt3QkFDVixZQUFZLEVBQUU7NEJBQ1osU0FBUyxFQUFFO2dDQUNULFFBQVEsRUFBRSxHQUFHLEVBQUUsT0FBTzs2QkFDdkI7eUJBQ0Y7cUJBQ0Y7aUJBQ0Y7YUFDSixDQUFDLENBQUE7WUFDRixPQUFPLFFBQVEsQ0FBQTtTQUNsQjtRQUNELE1BQ0E7WUFDSSxNQUFNLGtCQUFRLENBQUMsT0FBTyxDQUFDLDhGQUE4RixDQUFDLENBQUE7WUFDdEgsUUFBUSxHQUFDLE1BQU0sZ0JBQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUE7WUFDeEMsT0FBTyxRQUFRLENBQUE7U0FDbEI7SUFDTCxDQUFDO0NBQ1I7QUFuS0QscUNBbUtDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gaW1wb3J0IHR5cGUgeyBIdHRwQ29udGV4dENvbnRyYWN0IH0gZnJvbSAnQGlvYzpBZG9uaXMvQ29yZS9IdHRwQ29udGV4dCdcclxuaW1wb3J0IG1vbmdvb3NlIGZyb20gXCJtb25nb29zZVwiXHJcbmltcG9ydCBTZW5zb3JNb2RlbG8gZnJvbSBcIkFwcC9Nb2RlbHMvU2Vuc29yXCJcclxuaW1wb3J0IFZhbG9yZSBmcm9tIFwiQXBwL01vZGVscy9WYWxvcmVcIlxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZW5zb3Jlc0NvbnRyb2xsZXIgXHJcbntcclxuICAgICAgICBwdWJsaWMgYXN5bmMgZ3VhcmRhck1vbmdvKHtyZXF1ZXN0LHJlc3BvbnNlfSlcclxuICAgIHsgIFxyXG4gICAgICAgIGNvbnN0IHRyaWdnZXI9cmVxdWVzdC5pbnB1dCgndHJpZ2dlcicpXHJcbiAgICAgICAgY29uc3QgZWNobz1yZXF1ZXN0LmlucHV0KCdlY2hvJykgIFxyXG4gICAgICAgIHRyeVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdCgnbW9uZ29kYjovLzE4LjIyMC4xMi40OjI3MDE3L1NlbnNvcmVzP3JlYWRQcmVmZXJlbmNlPXByaW1hcnkmZGlyZWN0Q29ubmVjdGlvbj10cnVlJnNzbD1mYWxzZScpIFxyXG4gICAgICAgICAgICAgcmVzcG9uc2U9bmV3IFNlbnNvck1vZGVsby5TZW5zb3JNb2RlbG8oe1xyXG4gICAgICAgICAgICAgICAgXCJpZFwiOiByZXF1ZXN0LmlucHV0KCdpZCcpLFxyXG4gICAgICAgICAgICAgICAgXCJwaW5cIjogW3tcclxuICAgICAgICAgICAgICAgICAgIFwidHJpZ2dlclwiOnRyaWdnZXIsXHJcbiAgICAgICAgICAgICAgICAgICBcImVjaG9cIjplY2hvXHJcbiAgICAgICAgICAgICAgICB9XSxcclxuICAgICAgICAgICAgICAgIFwidGlwb1wiOiByZXF1ZXN0LmlucHV0KCd0aXBvJyksXHJcbiAgICAgICAgICAgICAgICBcImNsYXZlXCI6IHJlcXVlc3QuaW5wdXQoJ2NsYXZlJyksXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnNhdmUoKVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2hcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGF3YWl0IG1vbmdvb3NlLmNvbm5lY3QoJ21vbmdvZGI6Ly8zLjE0NS4yMTAuMzU6MjcwMTcvU2Vuc29yZXM/cmVhZFByZWZlcmVuY2U9cHJpbWFyeSZkaXJlY3RDb25uZWN0aW9uPXRydWUmc3NsPWZhbHNlJykgXHJcbiAgICAgICAgICAgICByZXNwb25zZT1uZXcgU2Vuc29yTW9kZWxvLlNlbnNvck1vZGVsbyh7XHJcbiAgICAgICAgICAgICAgICBcImlkXCI6IHJlcXVlc3QuaW5wdXQoJ2lkJyksXHJcbiAgICAgICAgICAgICAgICBcInBpblwiOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcixcclxuICAgICAgICAgICAgICAgICAgICBlY2hvXHJcbiAgICAgICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAgICAgXCJ0aXBvXCI6IHJlcXVlc3QuaW5wdXQoJ3RpcG8nKSxcclxuICAgICAgICAgICAgICAgIFwiY2xhdmVcIjogcmVxdWVzdC5pbnB1dCgnY2xhdmUnKSxcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgcmVzcG9uc2Uuc2F2ZSgpXHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHB1YmxpYyBhc3luYyB2ZXJTZW5zb3Ioe3BhcmFtcyxyZXNwb25zZX0pXHJcbiAgICB7XHJcbiAgICAgICAgdHJ5XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBhd2FpdCBtb25nb29zZS5jb25uZWN0KCdtb25nb2RiOi8vMTguMjIwLjEyLjQ6MjcwMTcvU2Vuc29yZXM/cmVhZFByZWZlcmVuY2U9cHJpbWFyeSZkaXJlY3RDb25uZWN0aW9uPXRydWUmc3NsPWZhbHNlJylcclxuICAgICAgICAgICAgcmVzcG9uc2U9YXdhaXQgU2Vuc29yTW9kZWxvLlNlbnNvck1vZGVsby5maW5kKHtcImlkXCI6cGFyYW1zLmlkfSlcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBhd2FpdCBtb25nb29zZS5jb25uZWN0KCdtb25nb2RiOi8vMy4xNDUuMjEwLjM1OjI3MDE3L1NlbnNvcmVzP3JlYWRQcmVmZXJlbmNlPXByaW1hcnkmZGlyZWN0Q29ubmVjdGlvbj10cnVlJnNzbD1mYWxzZScpXHJcbiAgICAgICAgICAgIHJlc3BvbnNlPWF3YWl0IFNlbnNvck1vZGVsby5TZW5zb3JNb2RlbG8uZmluZCh7XCJpZFwiOnBhcmFtcy5pZH0pXHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHB1YmxpYyBhc3luYyB2ZXJTZW5zb3Jlcyh7cmVzcG9uc2V9KVxyXG4gICAge1xyXG4gICAgICAgIHRyeVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdCgnbW9uZ29kYjovLzE4LjIyMC4xMi40OjI3MDE3L1NlbnNvcmVzP3JlYWRQcmVmZXJlbmNlPXByaW1hcnkmZGlyZWN0Q29ubmVjdGlvbj10cnVlJnNzbD1mYWxzZScpXHJcbiAgICAgICAgICAgIHJlc3BvbnNlPWF3YWl0IFNlbnNvck1vZGVsby5TZW5zb3JNb2RlbG8uZmluZCgpXHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVxyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdCgnbW9uZ29kYjovLzMuMTQ1LjIxMC4zNToyNzAxNy9TZW5zb3Jlcz9yZWFkUHJlZmVyZW5jZT1wcmltYXJ5JmRpcmVjdENvbm5lY3Rpb249dHJ1ZSZzc2w9ZmFsc2UnKVxyXG4gICAgICAgICAgICByZXNwb25zZT1hd2FpdCBTZW5zb3JNb2RlbG8uU2Vuc29yTW9kZWxvLmZpbmQoKVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgYXN5bmMgbW9kaWZpY2FyKHtyZXF1ZXN0LHJlc3BvbnNlfSlcclxuICAgIHtcclxuICAgICAgICB0cnlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGF3YWl0IG1vbmdvb3NlLmNvbm5lY3QoJ21vbmdvZGI6Ly8xOC4yMjAuMTIuNDoyNzAxNy9TZW5zb3Jlcz9yZWFkUHJlZmVyZW5jZT1wcmltYXJ5JmRpcmVjdENvbm5lY3Rpb249dHJ1ZSZzc2w9ZmFsc2UnKVxyXG4gICAgICAgICAgICBjb25zdCBpZD1yZXF1ZXN0LmlucHV0KCdpZCcpXHJcbiAgICAgICAgICAgIHJlc3BvbnNlPSBhd2FpdCBTZW5zb3JNb2RlbG8uU2Vuc29yTW9kZWxvLnVwZGF0ZU9uZSh7XCJpZFwiOmlkfSx7JHNldDp7XCJwaW5cIjp7XCJ0cmlnZ2VyXCI6cmVxdWVzdC5pbnB1dCgndHJpZ2dlcicpLFwiZWNob1wiOnJlcXVlc3QuaW5wdXQoJ2VjaG8nKX0sXCJ0aXBvXCI6cmVxdWVzdC5pbnB1dCgndGlwbycpLFwiY2xhdmVcIjpyZXF1ZXN0LmlucHV0KCdjbGF2ZScpfX0pXHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVxyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaFxyXG4gICAgICAgIHtcclxuLy8gICAgICAgICAgICBhd2FpdCBtb25nb29zZS5jb25uZWN0KCdtb25nb2RiOi8vMy4xNDUuMjEwLjM1OjI3MDE3L1NlbnNvcmVzP3JlYWRQcmVmZXJlbmNlPXByaW1hcnkmZGlyZWN0Q29ubmVjdGlvbj10cnVlJnNzbD1mYWxzZScpXHJcbi8vICAgICAgICAgICAgY29uc3QgaWQ9cmVxdWVzdC5pbnB1dCgnaWQnKVxyXG4vLyAgICAgICAgICAgIG1vZD0gYXdhaXQgU2Vuc29yTW9kZWxvLlNlbnNvck1vZGVsby51cGRhdGVPbmUoe1wiaWRcIjppZH0seyRwdWxsOntcInBpblwiOnskZ3RlOjF9fX0pXHJcbi8vICAgICAgICAgICAgcmVzcG9uc2U9IGF3YWl0IFNlbnNvck1vZGVsby5TZW5zb3JNb2RlbG8udXBkYXRlT25lKHtcImlkXCI6aWR9LHskcHVzaDp7XCJwaW5cIjpbcmVxdWVzdC5pbnB1dCgndHJpZ2dlcicpLHJlcXVlc3QuaW5wdXQoJ2VjaG8nKV19fSlcclxuLy8gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAgICAgcHVibGljIGFzeW5jIGd1YXJkYXJNZWRpY2lvbih7cmVxdWVzdCxyZXNwb25zZX0pXHJcbiAgICB7XHJcbiAgICAgICAgY29uc3QgaWQ9cmVxdWVzdC5pbnB1dCgnaWQnKVxyXG4gICAgICAgIGNvbnN0IGNsYXZlPXJlcXVlc3QuaW5wdXQoJ2NsYXZlJylcclxuICAgICAgICBjb25zdCBmZWNoYT1yZXF1ZXN0LmlucHV0KCdmZWNoYScpXHJcbiAgICAgICAgY29uc3QgaG9yYT1yZXF1ZXN0LmlucHV0KCdob3JhJylcclxuICAgICAgICBjb25zdCB2YWxvcj1yZXF1ZXN0LmlucHV0KCd2YWxvcicpXHJcbiAgICAgICAgdHJ5XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBhd2FpdCBtb25nb29zZS5jb25uZWN0KCdtb25nb2RiOi8vMTguMjIwLjEyLjQ6MjcwMTcvU2Vuc29yZXM/cmVhZFByZWZlcmVuY2U9cHJpbWFyeSZkaXJlY3RDb25uZWN0aW9uPXRydWUmc3NsPWZhbHNlJykgXHJcbiAgICAgICAgICAgICByZXNwb25zZT1uZXcgVmFsb3JlLlZhbG9yZSh7XHJcbiAgICAgICAgICAgICAgICBcImlkXCI6IGlkLFxyXG4gICAgICAgICAgICAgICAgXCJmZWNoYVwiOmZlY2hhLFxyXG4gICAgICAgICAgICAgICAgXCJjbGF2ZVwiOiBjbGF2ZSxcclxuICAgICAgICAgICAgICAgIFwiaG9yYVwiOmhvcmEsXHJcbiAgICAgICAgICAgICAgICBcInZhbG9yXCI6dmFsb3JcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgcmVzcG9uc2Uuc2F2ZSgpXHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVxyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdCgnbW9uZ29kYjovLzMuMTQ1LjIxMC4zNToyNzAxNy9TZW5zb3Jlcz9yZWFkUHJlZmVyZW5jZT1wcmltYXJ5JmRpcmVjdENvbm5lY3Rpb249dHJ1ZSZzc2w9ZmFsc2UnKSBcclxuICAgICAgICAgICAgIHJlc3BvbnNlPW5ldyBWYWxvcmUuVmFsb3JlKHtcclxuICAgICAgICAgICAgICAgIFwiaWRcIjogaWQsXHJcbiAgICAgICAgICAgICAgICBcImZlY2hhXCI6ZmVjaGEsXHJcbiAgICAgICAgICAgICAgICBcImNsYXZlXCI6IGNsYXZlLFxyXG4gICAgICAgICAgICAgICAgXCJob3JhXCI6aG9yYSxcclxuICAgICAgICAgICAgICAgIFwidmFsb3JcIjp2YWxvclxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICByZXNwb25zZS5zYXZlKClcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXHJcbiAgICB9XHJcbn1cclxuICAgICAgICBwdWJsaWMgYXN5bmMgVVMoe3BhcmFtcyxyZXNwb25zZX0pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0cnlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdCgnbW9uZ29kYjovLzE4LjIyMC4xMi40OjI3MDE3L1NlbnNvcmVzP3JlYWRQcmVmZXJlbmNlPXByaW1hcnkmZGlyZWN0Q29ubmVjdGlvbj10cnVlJnNzbD1mYWxzZScpXHJcbiAgICAgICAgICAgICAgICByZXNwb25zZT1hd2FpdCBWYWxvcmUuVmFsb3JlLmFnZ3JlZ2F0ZShbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgJyRtYXRjaCc6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2lkJzogTnVtYmVyKHBhcmFtcy5pZClcclxuICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAkbG9va3VwOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdmcm9tJzogJ3NlbnNvcnMnLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2xvY2FsRmllbGQnOiAnaWQnLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2ZvcmVpZ25GaWVsZCc6ICdpZCcsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnYXMnOiAnU2Vuc29yZXMnXHJcbiAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgJyR1bndpbmQnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdwYXRoJzogJyRTZW5zb3JlcycsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAncHJlc2VydmVOdWxsQW5kRW1wdHlBcnJheXMnOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgJyRwcm9qZWN0Jzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnaWQnOiAxLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXZlJzogMSwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICd2YWxvcic6IDEsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZF9hdCc6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnJGNvbmNhdCc6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICckZmVjaGEnLCAnICcsICckaG9yYSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2hcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdCgnbW9uZ29kYjovLzMuMTQ1LjIxMC4zNToyNzAxNy9TZW5zb3Jlcz9yZWFkUHJlZmVyZW5jZT1wcmltYXJ5JmRpcmVjdENvbm5lY3Rpb249dHJ1ZSZzc2w9ZmFsc2UnKVxyXG4gICAgICAgICAgICAgICAgcmVzcG9uc2U9YXdhaXQgVmFsb3JlLlZhbG9yZS5hZ2dyZWdhdGUoKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbn0gXHJcbiJdfQ==